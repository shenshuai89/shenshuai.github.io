<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="北鸟南游, 前端开发设计师">










<meta name="description" content="前端，设计师">
<meta property="og:type" content="website">
<meta property="og:title" content="北鸟南游&lt;br&gt;前端开发设计师">
<meta property="og:url" content="http://shenshuai.me/index.html">
<meta property="og:site_name" content="北鸟南游&lt;br&gt;前端开发设计师">
<meta property="og:description" content="前端，设计师">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="北鸟南游&lt;br&gt;前端开发设计师">
<meta name="twitter:description" content="前端，设计师">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":5},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenshuai.me/">





  <title>北鸟南游<br>前端开发设计师</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">北鸟南游<br>前端开发设计师</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">web前端开发，设计师</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenshuai.me/2019/06/18/js正则表达式深度解析/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenshuai.me">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="北鸟南游<br>前端开发设计师">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/18/js正则表达式深度解析/" itemprop="url">js正则表达式深度解析</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-18T21:02:33+08:00">
                2019-06-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/前端开发/" itemprop="url" rel="index">
                    <span itemprop="name">前端开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="正则简介和图形化工具使用"><a href="#正则简介和图形化工具使用" class="headerlink" title="正则简介和图形化工具使用"></a>正则简介和图形化工具使用</h2><p>正则表达式是一套匹配固定格式字符串的语法规则。常用来对字符串的查找替换等操作。<br>为了方便学习和使用正则表达式，可以借助图形化工具翻译<br>如网站<a href="https://regexper.com" target="_blank" rel="noopener">regexper</a>可以将表达式转换为图形语义<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\w&#123;3,8&#125;@(\w|\d)&#123;2,5&#125;\.(\w)&#123;2&#125;/</span></span><br></pre></td></tr></table></figure></p>
<p>如下图展示<img src="/images/regex1.png" alt="regex1">正则表达式可以通过对象字面量创建：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\d+/</span>;</span><br></pre></td></tr></table></figure></p>
<p>也可以使用构造函数创建 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\\bhello\\b'</span>,<span class="string">'g'</span>);</span><br></pre></td></tr></table></figure>
<p>正则表达式只有一个test方法，即(正则).<strong>test</strong>(字符串)，其他的为字符串方法如(字符串).<strong>match</strong>(正则)，(字符串).<strong>search</strong>(正则)，(字符串).<strong>replace</strong>(正则)，(字符串).<strong>split</strong>(正则)</p>
<h2 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h2><ul>
<li><p>g: global全局搜索，不添加的话，只搜索到第一个就会停止</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'上海市北京市郑州市'</span>.match(<span class="regexp">/市/</span>,<span class="string">"省"</span>)</span><br><span class="line"><span class="comment">// ["市", index: 2, input: "上海市北京市郑州市", groups: undefined]</span></span><br><span class="line"><span class="string">'上海市北京市郑州市'</span>.match(<span class="regexp">/市/g</span>,<span class="string">"省"</span>)</span><br><span class="line"><span class="comment">//  ["市", "市", "市"]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>i: ignore case 忽略大小写，默认是大小写敏感</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'heLlo worLd'</span>.replace(<span class="regexp">/l/g</span>,<span class="string">"!"</span>)</span><br><span class="line"><span class="string">"heL!o worLd"</span></span><br><span class="line"><span class="string">'heLlo worLd'</span>.replace(<span class="regexp">/l/gi</span>,<span class="string">"!"</span>)</span><br><span class="line"><span class="string">"he!!o wor!d"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>m：multiple line多行搜索 </p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"@123</span></span><br><span class="line"><span class="string">@456</span></span><br><span class="line"><span class="string">@789"</span>.replace(<span class="regexp">/^@./g</span>,<span class="string">"!"</span>)</span><br><span class="line"><span class="string">"!23</span></span><br><span class="line"><span class="string">@456</span></span><br><span class="line"><span class="string">@789"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"@123</span></span><br><span class="line"><span class="string">@456</span></span><br><span class="line"><span class="string">@789"</span>.replace(<span class="regexp">/^@./gm</span>,<span class="string">"!"</span>)</span><br><span class="line"><span class="string">"!23</span></span><br><span class="line"><span class="string">!56</span></span><br><span class="line"><span class="string">!89"</span></span><br></pre></td></tr></table></figure>
<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p>正则表达是有两种基本字符类型组成</p>
<ul>
<li><p>原义文本字符：如“是”，“s”</p>
</li>
<li><p>元字符:在正则表达式中有特殊含义的非字母字符<br>^ |  $ ? <em> + . \ ( ) { } [ ]<br>|名称|含义|<br>|:—|:–:|<br>| ^ | 匹配输入字符串的开始位置。如果是在[]内，表示否定的意思 |<br>| $ | 匹配字符串结束的位置。 |<br>| . | 匹配除换行符（\n、\r）之外的任何单个字符。 |<br>| \ | 将下一个字符标记为一个特殊字符的引用转义符。 |<br>| </em> | 匹配显示零次或多次 |<br>| + | 匹配显示1次或多次 |<br>| ? | 匹配显示0次或1次 |<br>| \b | 匹配一个单词边界，也就是指单词和空格间的位置。 |<br>| \B | 匹配非单词边界。 |<br>| \d | 匹配一个数字字符。 |<br>| \D |匹配一个非数字字符。 |<br>| \n |匹配一个换行符。 |<br>| \r | 匹配一个回车符 |<br>| \s | 匹配任何空白字符，包括空格、制表符、换页符等等。 |<br>| \S | 匹配任何非空白字符。 |<br>| \w | 匹配字母、数字、下划线。 |<br>| \W | 匹配非字母、数字、下划线。 |</p>
<p><strong>\b</strong>  匹配边界值<br><img src="/images/regex2.png" alt="regex2"></p>
</li>
</ul>
<p>“hello world lo”.replace(/lo\b/g,”!”)       &gt;   “hel! world !”</p>
<p>“hello world lo”.replace(/\Blo\b/g,”!”)   &gt;   “hel! world lo”</p>
<p>  <strong>\w</strong><br>  <img src="/images/regex3.png" alt="regex3"><br>  <strong>\d</strong><br>  <img src="/images/regex4.png" alt="regex4"></p>
<h2 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h2><p>一般情况下正则字符匹配的是一个字符串。如果匹配一类特性的字符，要创建一个特定的字符类，元字符[]可以把一些字符归为一类，表达式可以匹配这一类的字符。</p>
<p>如果使用/[hello]/,匹配到单独的或h、或e、或l、或o单个字母<br>/hello/匹配到完整的hello单词</p>
<p>/[hello]/<br> <img src="/images/regex5.png" alt="regex5"><br>/hello/<br> <img src="/images/regex6.png" alt="regex6"></p>
<p> <strong>在字符类里面写上^表示否定</strong></p>
<p>[^hello]<br> <img src="/images/^hello.png" alt="^hello"></p>
<h2 id="量词"><a href="#量词" class="headerlink" title="量词"></a>量词</h2><p>{20}匹配20次<br>{4,}至少4次<br>{1,5}1次到5次<br>{0,8} 0次到8次<br>? 零次或一次，最多一次<br>+一次或多次，至少一次<br>*零次或者多次</p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>可以使用()对要匹配的内容进行分组<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"a1a2a3a4"</span>.replace(<span class="regexp">/\w\d&#123;3&#125;/g</span>,<span class="string">"X"</span>)</span><br><span class="line"><span class="comment">// 匹配不到结果 "a1a2a3a4"</span></span><br><span class="line"><span class="string">"a1a2a3a4"</span>.replace(<span class="regexp">/(\w\d)&#123;3&#125;/g</span>,<span class="string">"X"</span>)</span><br><span class="line"><span class="comment">//可以匹配字母加数字的重复3次  "Xa4"</span></span><br></pre></td></tr></table></figure></p>
<p>分组常用于改变数据格式，反向引用<br>$代表分组的内容，$1表示第一组，$2表示第二组<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"2019-08-06"</span>.replace(<span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/g</span>,<span class="string">"$2/$3/$1"</span>)</span><br><span class="line"><span class="comment">// "08/06/2019"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="范围类"><a href="#范围类" class="headerlink" title="范围类"></a>范围类</h2><p>正则表达式里有创建字符类，可以用来匹配一类字符，如[0123456789],这样会造成书写困难不雅观。可以直接写成[0-9],字母可以写成[a-z]。这是一个闭区间，包含了两头的字符。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"2019-05-01"</span>.replace(<span class="regexp">/[0-9]/g</span>,<span class="string">"x"</span>)  =&gt;  <span class="string">"xxxx-xx-xx"</span></span><br><span class="line"><span class="string">"2019-05-01"</span>.replace(<span class="regexp">/[0-9-]/g</span>,<span class="string">"x"</span>)  =&gt; <span class="string">"xxxxxxxxxx"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="贪婪模式和非贪婪模式"><a href="#贪婪模式和非贪婪模式" class="headerlink" title="贪婪模式和非贪婪模式"></a>贪婪模式和非贪婪模式</h2><p>正则表达式会尽可能多的匹配，默认贪婪模式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"1234567"</span>.replace(<span class="regexp">/\d&#123;3,5&#125;/g</span>,<span class="string">"X"</span>)</span><br><span class="line"><span class="comment">// "X67"</span></span><br></pre></td></tr></table></figure></p>
<p>将贪婪模式转为非贪婪模式，只需要在量词后加?<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"1234567"</span>.replace(<span class="regexp">/\d&#123;3,5&#125;?/g</span>,<span class="string">"X"</span>)</span><br><span class="line"><span class="comment">// "XX7"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="前瞻"><a href="#前瞻" class="headerlink" title="前瞻"></a>前瞻</h2><p>正则表达式从文本左边往右边匹配解析，向右边的方向称作“前”<br>从右往左匹配称作“后”<br><strong>正向前瞻</strong>  exp(?=assert)  当符合了第一个表达式后，继续向右查看是否符合断言部分（也是正则表达式），符合了则为匹配<br><strong>负向前瞻</strong>  exp(?!assert)   当符合了第一个表达式后，继续向右查看是否符合断言部分（也是正则表达式），不符合断言，则为匹配</p>
<p><strong><u>断言部分不参与替换</u></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"123wfor!dword789"</span>.replace(<span class="regexp">/\d&#123;3&#125;(?!(w))/g</span>,<span class="string">"N"</span>)</span><br><span class="line"><span class="comment">// "123wfor!dwordN" 匹配到789并替换成N，因为123后面是w，不符合断言部分的后边不是w条件</span></span><br><span class="line"><span class="string">"123wfor!dword789"</span>.replace(<span class="regexp">/\d&#123;3&#125;(?!(f))/g</span>,<span class="string">"N"</span>)</span><br><span class="line"><span class="comment">// "Nwfor!dwordN"  匹配到123和789，断言是后边不能是f，都符合条件</span></span><br><span class="line"><span class="string">"123wfor!dword789"</span>.replace(<span class="regexp">/\d&#123;3&#125;((?!(for)).)*$/g</span>,<span class="string">"N"</span>)</span><br><span class="line"><span class="comment">//"123wfor!dwordN" 匹配到了789，因为123后边包含了for单词   </span></span><br><span class="line"><span class="comment">// (assert.)*$表示以任意字符结尾往左查找，来判断断言部分的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ((?!word).)*$ 表示字符串中不能包含word的断言</span></span><br><span class="line"><span class="string">"123wfor!dword789"</span>.replace(<span class="regexp">/\d&#123;3&#125;((?!(word)).)*$/g</span>,<span class="string">"N"</span>)</span><br><span class="line"><span class="comment">//"123wfor!dwordN"</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenshuai.me/2019/05/24/使用node的express框架搭建的webSocket请求/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenshuai.me">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="北鸟南游<br>前端开发设计师">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/24/使用node的express框架搭建的webSocket请求/" itemprop="url">使用node的express框架搭建的webSocket请求</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-24T17:42:33+08:00">
                2019-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/前端开发/" itemprop="url" rel="index">
                    <span itemprop="name">前端开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用ws创建WebSocket服务"><a href="#使用ws创建WebSocket服务" class="headerlink" title="使用ws创建WebSocket服务"></a>使用ws创建WebSocket服务</h1><h2 id="新建package-json，用于安装ws"><a href="#新建package-json，用于安装ws" class="headerlink" title="新建package.json，用于安装ws"></a>新建package.json，用于安装ws</h2><p>执行npm init -y生成package.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"echo"</span>,</span><br><span class="line">	<span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">	<span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">		<span class="attr">"express"</span>: <span class="string">"4.17.0"</span>,</span><br><span class="line">		<span class="attr">"ws"</span>: <span class="string">"^7.0.0"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行$npm install 命令安装依赖包</p>
<p>创建一个server.js。作为项目启动的服务器，新建一个public文件夹，用来放置静态文件。<br>以下是server.js的内容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> WebSocket = <span class="built_in">require</span>(<span class="string">"ws"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//这一部分不能使用express创建服务的简写方法。</span></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(app);</span><br><span class="line"><span class="keyword">var</span> wss = <span class="keyword">new</span> WebSocket.Server(&#123;server&#125;)</span><br><span class="line"></span><br><span class="line">app.use(express.static(__dirname + <span class="string">"/public"</span>))</span><br><span class="line"></span><br><span class="line">wss.on(<span class="string">"connection"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ws</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"连接成功"</span>);</span><br><span class="line">  ws.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"接收到客户端的数据："</span>+data);</span><br><span class="line">    <span class="comment">// 后台接收到前端的数据后，向前端发送数据</span></span><br><span class="line">    ws.send(<span class="string">"server返回的："</span>+data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">1688</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"服务器启动成功，通过1688端口访问"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>在public文件夹下，创建index.html文件<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>websocket echo<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h2</span>&gt;</span>latency: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"latency"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>ms<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lastMessage;</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://127.0.0.1:1688'</span>);</span><br><span class="line">	ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">		ping();   </span><br><span class="line">	&#125;;</span><br><span class="line">	ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;<span class="comment">//当链接关闭的时候触发</span></span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line">	ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;<span class="comment">//后台返回消息的时候触发</span></span><br><span class="line">		<span class="built_in">console</span>.log(e.data);</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">new</span> <span class="built_in">Date</span> - lastMessage&gt;<span class="number">20</span>)&#123;</span><br><span class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"latency"</span>).innerHTML = <span class="string">"响应时间过长，停止请求"</span>;</span><br><span class="line">			ws.close();</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">document</span>.getElementById(<span class="string">"latency"</span>).innerHTML = <span class="keyword">new</span> <span class="built_in">Date</span> - lastMessage;</span><br><span class="line">		setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">"计算出耗时之后，2s再发一次请求"</span>);</span><br><span class="line">			ping();</span><br><span class="line">		&#125;,<span class="number">2000</span>)</span><br><span class="line">	&#125;;</span><br><span class="line">	ws.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;<span class="comment">//错误情况触发</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">ping</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			lastMessage = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">			ws.send(<span class="string">"ping"</span>);   <span class="comment">//向后台发送数据</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后可以使用node server.js启动服务，打开index.html文件就可以看到websocket发送和接收的数据。</p>
<h2 id="只使用ws创建服务"><a href="#只使用ws创建服务" class="headerlink" title="只使用ws创建服务"></a>只使用ws创建服务</h2><p>单独使用ws创建服务，然后直接在浏览器打开index.html即可访问。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WebSocketServer = WebSocket.Server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wss = <span class="keyword">new</span> WebSocketServer(&#123;</span><br><span class="line">    port: <span class="number">1688</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">wss.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ws</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"连接成功"</span>);</span><br><span class="line">    ws.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"接收到客户端的数据："</span> + data);</span><br><span class="line">        <span class="comment">// 后台接收到前端的数据后，向前端发送数据</span></span><br><span class="line">        ws.send(<span class="string">"server返回的："</span> + data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ws server started at port 1688...'</span>);</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenshuai.me/2019/05/15/webpackDevLibrary/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenshuai.me">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="北鸟南游<br>前端开发设计师">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/15/webpackDevLibrary/" itemprop="url">webpackDevLibrary</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-15T15:03:33+08:00">
                2019-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/前端开发/" itemprop="url" rel="index">
                    <span itemprop="name">前端开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用webpack开发一个npm包，并发布到npmjs"><a href="#使用webpack开发一个npm包，并发布到npmjs" class="headerlink" title="使用webpack开发一个npm包，并发布到npmjs"></a>使用webpack开发一个npm包，并发布到npmjs</h1><h2 id="创建webpack开发环境-设置package-json"><a href="#创建webpack开发环境-设置package-json" class="headerlink" title="创建webpack开发环境,设置package.json"></a>创建webpack开发环境,设置package.json</h2><p>执行npm init -y生成package.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"num-word-chinese"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"将数字转成英文单词或者中文大写"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"dist/num-word-chinese.js"</span>,</span><br><span class="line">  <span class="attr">"module"</span>: <span class="string">"src/index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.31.0"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.3.2"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"lodash"</span>: <span class="string">"^4.17.11"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>main指定访问生成的js插件的入口</li>
<li>module将js包添加为标准模块</li>
<li>devDependencies，编译生成js包所需的开发依赖包，这里面引用的包，使用者使用安装该js时，不会下载这些依赖。</li>
<li>dependencies，js包运行所需的依赖包，这里面引用的包，使用者使用安装该js时，会自动下载这些依赖。</li>
</ul>
<h2 id="创建webpack-config-js修改配置"><a href="#创建webpack-config-js修改配置" class="headerlink" title="创建webpack.config.js修改配置"></a>创建webpack.config.js修改配置</h2><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>现在，让我们以某种方式打包这个 library，能够实现以下几个目标：</p>
<ul>
<li>使用 externals 选项，避免将 lodash 打包到应用程序，而使用者会去加载它。</li>
<li>将 library 的名称设置为 num-word-chinese。</li>
<li>将 library 暴露为一个名为 numWordChinese 的变量。</li>
<li>能够访问其他 Node.js 中的 library。</li>
</ul>
<p>此外，consumer(使用者) 应该能够通过以下方式访问 library：</p>
<ul>
<li>ES2015 模块。例如 import numWordChinese from ‘num-word-chinese’。</li>
<li>CommonJS 模块。例如 require(‘num-word-chinese’).</li>
<li>全局变量，在通过 script 标签引入时</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'num-word-chinese.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="外部化lodash"><a href="#外部化lodash" class="headerlink" title="外部化lodash"></a>外部化lodash</h3><p>现在，如果执行 webpack，你会发现创建了一个体积相当大的文件。如果你查看这个文件，会看到 lodash 也被打包到代码中。在这种场景中，我们更倾向于把 lodash 当作 peerDependency。也就是说，consumer(使用者) 应该已经安装过 lodash 。因此，你就可以放弃控制此外部 library ，而是将控制权让给使用 library 的 consumer。</p>
<p>这可以使用 externals 配置来完成：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'num-word-chinese.js'</span></span><br><span class="line"> &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> externals: &#123;</span><br><span class="line">   lodash: &#123;</span><br><span class="line">     commonjs: <span class="string">'lodash'</span>,</span><br><span class="line">     commonjs2: <span class="string">'lodash'</span>,</span><br><span class="line">     amd: <span class="string">'lodash'</span>,</span><br><span class="line">     root: <span class="string">'_'</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h3 id="暴露-library"><a href="#暴露-library" class="headerlink" title="暴露 library"></a>暴露 library</h3><p>对于用法广泛的 library，我们希望它能够兼容不同的环境，例如 CommonJS，AMD，Node.js 或者作为一个全局变量。为了让你的 library 能够在各种使用环境中可用，需要在 output 中添加 library 属性：<br>library: ‘numWordChinese’<br>将你的 library bundle 暴露为名为 numWordChinese 的全局变量，consumer 通过此名称来 import。为了让 library 和其他环境兼容，则需要在配置中添加 libraryTarget 属性。这个选项可以控制以不同形式暴露 library。最重要的模块输出选项应该是 libraryTarget ，它是用来决定模块以何种规范输出，在全局变量的 Name 是啥。其基本格式为：</p>
<p>output.libraryTarget[String]: var | assign | this | window | global | commonjs | commonjs2 | amd | umd<br>上面那些全部是都是可选项值。这里先告诉大家，在现代 JS 的写法中，最后一个 umd 的选项是最常用的。<br>libraryTarget: ‘umd’</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'num-word-chinese.js'</span>,</span><br><span class="line">        library: <span class="string">'numWordChinese'</span>,</span><br><span class="line">        libraryTarget: <span class="string">'umd'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    externals: &#123;</span><br><span class="line">        lodash: &#123;</span><br><span class="line">            commonjs: <span class="string">'lodash'</span>,</span><br><span class="line">            commonjs2: <span class="string">'lodash'</span>,</span><br><span class="line">            amd: <span class="string">'lodash'</span>,</span><br><span class="line">            root: <span class="string">'_'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="添加npm包的应用功能"><a href="#添加npm包的应用功能" class="headerlink" title="添加npm包的应用功能"></a>添加npm包的应用功能</h2><p>src/index.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br><span class="line"><span class="keyword">import</span> numRef <span class="keyword">from</span> <span class="string">'./ref.json'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">numToWord</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(numRef, (accum, ref) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> ref.num === num ? ref.word : accum;</span><br><span class="line">  &#125;, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">numToChinese</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(numRef, (accum, ref) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> ref.num === num ? ref.chinese : accum;</span><br><span class="line">  &#125;, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">wordToNum</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(numRef, (accum, ref) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> ref.word === word &amp;&amp; word.toLowerCase() ? ref.num : accum;</span><br><span class="line">  &#125;, <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">chineseCurrency</span>(<span class="params">number</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chineseNumber = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">var</span> num = [<span class="string">"零"</span>, <span class="string">"壹"</span>, <span class="string">"贰"</span>, <span class="string">"叁"</span>, <span class="string">"肆"</span>, <span class="string">"伍"</span>, <span class="string">"陆"</span>, <span class="string">"柒"</span>, <span class="string">"捌"</span>, <span class="string">"玖"</span> ];</span><br><span class="line">  <span class="keyword">var</span> unit = [<span class="string">"分"</span>, <span class="string">"角"</span>, <span class="string">"圆"</span>, <span class="string">"拾"</span>, <span class="string">"佰"</span>, <span class="string">"仟"</span>, <span class="string">"万"</span>, <span class="string">"拾"</span>, <span class="string">"佰"</span>, <span class="string">"仟"</span>, <span class="string">"亿"</span>, <span class="string">"拾"</span>, <span class="string">"佰"</span>, <span class="string">"仟"</span>, <span class="string">"万"</span> ];</span><br><span class="line">  <span class="keyword">var</span> tempNumber = <span class="built_in">Math</span>.round(number * <span class="number">100</span>) + <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">var</span> tempNumberLength = tempNumber.length;</span><br><span class="line">  <span class="keyword">if</span>(<span class="string">"0"</span> === tempNumber)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"零元整"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(tempNumberLength &gt; <span class="number">15</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"超出转化范围"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> preReadZero = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = tempNumberLength; i &gt; <span class="number">0</span>; i--)&#123;</span><br><span class="line">    <span class="keyword">if</span> ((tempNumberLength - i + <span class="number">2</span>) % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i - <span class="number">4</span> &gt;= <span class="number">0</span> &amp;&amp; <span class="string">"0000"</span> === tempNumber.substring(i - <span class="number">4</span>, i)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!preReadZero) &#123;</span><br><span class="line">          chineseNumber = <span class="string">"零"</span> + chineseNumber  ;</span><br><span class="line">          preReadZero = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i -= <span class="number">3</span>; </span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      preReadZero = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> digit = <span class="built_in">parseInt</span>(tempNumber.substring(i - <span class="number">1</span>, i), <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (digit == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!preReadZero) &#123;</span><br><span class="line">        chineseNumber = <span class="string">"零"</span> + chineseNumber  ;</span><br><span class="line">        preReadZero = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ((tempNumberLength - i + <span class="number">2</span>) % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        chineseNumber = unit[tempNumberLength - i] + chineseNumber  ;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      chineseNumber = num[digit] + unit[tempNumberLength - i] + chineseNumber;</span><br><span class="line">      preReadZero = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (tempNumberLength - <span class="number">2</span> &gt;= <span class="number">0</span> &amp;&amp; <span class="string">"00"</span> === tempNumber.substring(tempNumberLength - <span class="number">2</span>, tempNumberLength))&#123;</span><br><span class="line">    chineseNumber += <span class="string">"整"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> chineseNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>numToWord数字转英文</li>
<li>numToChinese数字转中文</li>
<li>chineseCurrency数字转金融货币写法</li>
</ul>
<h2 id="使用npm-publish发布包"><a href="#使用npm-publish发布包" class="headerlink" title="使用npm publish发布包"></a>使用npm publish发布包</h2><p>安装好webpack和webpack-cli<br>执行webpack命令将src/index.js打包到dist/num-word-chinese.js<br>登录npm，第一次登录npm adduser；<br>以后登录npm login<br>登录成功之后，执行npm publish发布程序包</p>
<h2 id="测试包的使用"><a href="#测试包的使用" class="headerlink" title="测试包的使用"></a>测试包的使用</h2><p>发布成功后，可以npm install –save-dev num-word-chinese安装包<br>初始化一套支持Es6的webpack环境进行测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> numWordChinese <span class="keyword">from</span> <span class="string">'num-word-chinese'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(numWordChinese.numToWord(<span class="number">8</span>));</span><br><span class="line"><span class="built_in">console</span>.log(numWordChinese.numToChinese(<span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(numWordChinese.chineseCurrency(<span class="number">88845</span>));</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenshuai.me/2019/03/24/学习less/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenshuai.me">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="北鸟南游<br>前端开发设计师">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/24/学习less/" itemprop="url">学习less</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-24T09:20:03+08:00">
                2019-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/前端开发/" itemprop="url" rel="index">
                    <span itemprop="name">前端开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="css的预处理语言，可以理解成是对css的一层封装，但最终less代码还是要编译成css，浏览器不认识less。"><a href="#css的预处理语言，可以理解成是对css的一层封装，但最终less代码还是要编译成css，浏览器不认识less。" class="headerlink" title="css的预处理语言，可以理解成是对css的一层封装，但最终less代码还是要编译成css，浏览器不认识less。"></a>css的预处理语言，可以理解成是对css的一层封装，但最终less代码还是要编译成css，浏览器不认识less。</h2><p>使用less的方法</p>
<ul>
<li>直接引用less文件，并且引入less.min.js文件做编译</li>
<li>借助一下工具将less转为css</li>
<li>使用node进行编译 首先安装node install -g less@latest，然后使用lessc命令对less文件编译</li>
</ul>
<h2 id="less嵌套写法-嵌套"><a href="#less嵌套写法-嵌套" class="headerlink" title="less嵌套写法 嵌套"></a>less嵌套写法 嵌套</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span>&#123;</span><br><span class="line">	<span class="attribute">height</span>:<span class="number">500px</span>;</span><br><span class="line">	.content&#123;</span><br><span class="line">		<span class="selector-tag">width</span><span class="selector-pseudo">:1200px</span>;</span><br><span class="line">		<span class="selector-tag">height</span><span class="selector-pseudo">:600px</span>;</span><br><span class="line">		<span class="selector-tag">margin</span><span class="selector-pseudo">:0</span> <span class="selector-tag">auto</span>;</span><br><span class="line">		<span class="selector-tag">a</span>&#123;</span><br><span class="line">			<span class="attribute">color</span>:<span class="number">#fee</span>;</span><br><span class="line">			&amp;:hover&#123;</span><br><span class="line">				<span class="selector-tag">color</span>:<span class="selector-id">#e33</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="selector-class">.left</span>&#123;</span><br><span class="line">			<span class="attribute">float</span>:left;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="selector-class">.right</span>&#123;</span><br><span class="line">			<span class="attribute">float</span>:right;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="less的变量"><a href="#less的变量" class="headerlink" title="less的变量"></a>less的变量</h2><p>变量允许定义一套通用的样式，在需要的时候直接调用变量，以便后期做调整修改<br>@width:12px;<br>.border{<br>    width:@width;<br>}</p>
<h2 id="混合，可以把定义好的classA应用到classB上"><a href="#混合，可以把定义好的classA应用到classB上" class="headerlink" title="混合，可以把定义好的classA应用到classB上"></a>混合，可以把定义好的classA应用到classB上</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.classA</span>&#123;</span><br><span class="line">	<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.classB</span>&#123;</span><br><span class="line">	.classA</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>清除浮动样式的混合使用<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearFix</span>&#123;</span><br><span class="line">	*zoom:1;</span><br><span class="line">	&amp;<span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">		<span class="attribute">content</span>:<span class="string">''</span>;</span><br><span class="line">		<span class="attribute">display</span>:block;</span><br><span class="line">		<span class="attribute">clear</span>:both;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.classA</span>&#123;</span><br><span class="line">	.clearFix</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>带参数的混合<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.border</span>(@<span class="keyword">color</span>)&#123;</span><br><span class="line">	<span class="selector-tag">border</span><span class="selector-pseudo">:1px</span> <span class="selector-tag">solid</span> @<span class="keyword">color</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box1</span>&#123;</span><br><span class="line">	.border(#f33);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box2</span>&#123;</span><br><span class="line">	.border(#33f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>带默认值的参数混合<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.border(@width:1px,@style:solid)&#123;</span><br><span class="line">	<span class="selector-tag">border</span>:@<span class="keyword">width</span> @style #<span class="number">033</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box1</span>&#123;</span><br><span class="line">	.border(2px);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box2</span>&#123;</span><br><span class="line">	.border();</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box3</span>&#123;</span><br><span class="line">	.border(1px,dotted)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据不同模式的匹配混合<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.border(top,@width:1px)&#123;</span><br><span class="line">	<span class="selector-tag">border-top</span>:@<span class="keyword">width</span> solid #<span class="number">333</span>;</span><br><span class="line">&#125;</span><br><span class="line">.border(left,@width:1px)&#123;</span><br><span class="line">	<span class="selector-tag">border-left</span>:@<span class="keyword">width</span> solid #<span class="number">333</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box1</span>&#123;</span><br><span class="line">	.border(top);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box2</span>&#123;</span><br><span class="line">	.border(left,2px)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="less文件的互相调用"><a href="#less文件的互相调用" class="headerlink" title="less文件的互相调用"></a>less文件的互相调用</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"global.less"</span></span><br></pre></td></tr></table></figure>
<h2 id="less避免编译"><a href="#less避免编译" class="headerlink" title="less避免编译"></a>less避免编译</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@rem:32rem;</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>:@rem;</span><br><span class="line">	<span class="attribute">font</span>:(<span class="number">12</span>/@rem)~<span class="string">'/'</span>(<span class="number">24</span>/@rem) <span class="string">'宋体'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenshuai.me/2018/12/13/ajax的跨域和jsonp的使用/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenshuai.me">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="北鸟南游<br>前端开发设计师">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/13/ajax的跨域和jsonp的使用/" itemprop="url">ajax的跨域和jsonp的使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-13T11:05:18+08:00">
                2018-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/前端开发/" itemprop="url" rel="index">
                    <span itemprop="name">前端开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文章中源码地址：<a href="https://github.com/shenshuai89/ajax-jsonp" target="_blank" rel="noopener">github</a></p>
<h2 id="JavaScript原生ajax对象"><a href="#JavaScript原生ajax对象" class="headerlink" title="JavaScript原生ajax对象"></a>JavaScript原生ajax对象</h2><p>web页面和数据的交互读取是网页的基本功能，使用ajax是常用的技术方案之一。<br>通过创建var xhr = new XMLHttpRequest()对象来进行工作。<br>代码参考文件ajax.html<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'get'</span>,<span class="string">'back.php?a=1&amp;b=2'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(xhr.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status&lt;<span class="number">300</span>) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			alert(<span class="string">"出错了"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="使用ajax技术的跨域实现"><a href="#使用ajax技术的跨域实现" class="headerlink" title="使用ajax技术的跨域实现"></a>使用ajax技术的跨域实现</h2><p>当请求数据的地址和前端接口不在一个服务器上，或者端口号不同，都会造成跨域，解决跨域的方案cors<br>通过给服务器端的Access-Control-Allow-Origin设置*通配符<br>代码参考文件ajax-cros.html，后端是server文件夹下的node_server.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">"post"</span>,<span class="string">"http://localhost:8088"</span>,<span class="literal">true</span>)</span><br><span class="line">xhr.send();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(readyState==<span class="number">4</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>( (xhr.status&gt;=<span class="number">200</span>&amp;&amp;xhr.status&lt;<span class="number">300</span> ) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			alert(<span class="string">"出错了"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	<span class="comment">// 添加配置，可以跨域</span></span><br><span class="line">	res.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">	res.write(<span class="string">'aaa'</span>);</span><br><span class="line">	res.end();</span><br><span class="line">&#125;).listen(<span class="number">8088</span>)</span><br></pre></td></tr></table></figure>
<h2 id="jsonp实现跨域"><a href="#jsonp实现跨域" class="headerlink" title="jsonp实现跨域"></a>jsonp实现跨域</h2><p>在同源策略下，在某个服务器下的页面是无法获取到该服务器以外的数据的，但img、iframe、script等标签是个例外，这些标签可以通过src属性请求到其他服务器上的数据。利用script标签的开放策略，我们可以实现跨域请求数据，当然，也需要服务端的配合。当我们正常地请求一个JSON数据的时候，服务端返回的是一串JSON类型的数据，而我们使用JSONP模式来请求数据的时候，服务端返回的是一段可执行的JavaScript代码。</p>
<h3 id="原生js实现jsonp"><a href="#原生js实现jsonp" class="headerlink" title="原生js实现jsonp"></a>原生js实现jsonp</h3><p>使用jsonp调用百度请求数据的接口<br>代码参考文件jsonp.html<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">json</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> oUl = <span class="built_in">document</span>.querySelector(<span class="string">"#ullist"</span>)</span><br><span class="line"></span><br><span class="line">		oUl.innerHTML = <span class="string">''</span></span><br><span class="line">		json.s.forEach(<span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">let</span> oLi = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">			oLi.innerHTML = str;</span><br><span class="line"></span><br><span class="line">			oUl.append(oLi);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">window.onload = function()&#123;</span></span><br><span class="line"><span class="regexp">	var oInput = document.querySelector("#inp1")</span></span><br><span class="line"><span class="regexp">	var oUl = document.querySelector("#ullist")</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	oInput.oninput = function()&#123;</span></span><br><span class="line"><span class="regexp">		/</span><span class="regexp">/ 创建一个script标签</span></span><br><span class="line"><span class="regexp">		let oS = document.createElement("script");</span></span><br><span class="line"><span class="regexp">		/</span><span class="regexp">/ 百度请求数据的jsonp接口，回调方法为cb，数据为wd</span></span><br><span class="line"><span class="regexp">		oS.src = `https:/</span><span class="regexp">/sp0.baidu.com/</span><span class="number">5</span>a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=$&#123;oInput.value&#125;&amp;cb=show<span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		document.head.append(oS)</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"inp1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"ullist"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="jquery实现jsonp"><a href="#jquery实现jsonp" class="headerlink" title="jquery实现jsonp"></a>jquery实现jsonp</h3><p>源代码参考文件jsonp-js.html<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先引入jquery.js</span></span><br><span class="line">&lt;script src=<span class="string">"./js/jquery.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="string">"#inp1"</span>).on(<span class="string">'input'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			$.ajax(&#123;</span><br><span class="line">				url:<span class="string">"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su"</span>,</span><br><span class="line">				data:&#123;</span><br><span class="line">					wd:$(<span class="string">'#inp1'</span>).val()</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="comment">// 下面的两个对象为必填</span></span><br><span class="line">				dataType:<span class="string">'jsonp'</span>,</span><br><span class="line">				jsonp:<span class="string">'cb'</span>,</span><br><span class="line">				success(json)&#123;</span><br><span class="line">					<span class="built_in">console</span>.log(json.s)</span><br><span class="line">					$(<span class="string">"#ullist"</span>).html(<span class="string">''</span>);</span><br><span class="line">					json.s.forEach(<span class="function"><span class="params">str</span> =&gt;</span>&#123;</span><br><span class="line">						$(<span class="string">'&lt;li&gt;'</span>+str+<span class="string">'&lt;/li&gt;'</span>).appendTo(<span class="string">"#ullist"</span>);</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;,</span><br><span class="line">				error()&#123;</span><br><span class="line">					alert(<span class="string">'error'</span>)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">		</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用node服务器写一个jsonp后端接口"><a href="#使用node服务器写一个jsonp后端接口" class="headerlink" title="使用node服务器写一个jsonp后端接口"></a>使用node服务器写一个jsonp后端接口</h2><p>代码参考文件jsonp_server.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> &#123;pathname, query&#125; = url.parse(req.url, <span class="literal">true</span>);</span><br><span class="line">	<span class="keyword">let</span> &#123;a, b, callback&#125; = query;</span><br><span class="line">	res.write(<span class="string">`<span class="subst">$&#123;callback&#125;</span>(<span class="subst">$&#123;<span class="built_in">parseInt</span>(a)+<span class="built_in">parseInt</span>(b)&#125;</span>)`</span>);</span><br><span class="line">	res.end();</span><br><span class="line">&#125;).listen(<span class="number">8088</span>)</span><br></pre></td></tr></table></figure></p>
<p>前端页面文件nodeserver_jsonp.html<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">	<span class="keyword">function</span> show(json)&#123;</span><br><span class="line">		alert(json)</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	window.onload = <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">		var oInput = document.querySelector(<span class="string">"#inp1"</span>)</span><br><span class="line">		var oUl = document.querySelector(<span class="string">"#ullist"</span>)</span><br><span class="line"></span><br><span class="line">		oInput.onclick = <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">			// 创建script标签</span><br><span class="line">			<span class="built_in">let</span> oS = document.createElement(<span class="string">"script"</span>);</span><br><span class="line">			// 把回调方法定义为callback</span><br><span class="line">			oS.src = `http://localhost:8088?a=50&amp;b=60&amp;callback=show`</span><br><span class="line"></span><br><span class="line">			document.head.append(oS)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"inp1"</span> <span class="attr">value</span>=<span class="string">"计算"</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="shenshuai.me">
            
              <p class="site-author-name" itemprop="name">shenshuai.me</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/shenshuai89" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/beiniaonanyou" target="_blank" title="sina">
                      
                        <i class="fa fa-fw fa-weibo"></i>sina</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenshuai89@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://jsfiddle.net/user/shenshuai" target="_blank" title="jsfiddle">
                      
                        <i class="fa fa-fw fa-jsfiddle"></i>jsfiddle</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shenshuai.me</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
